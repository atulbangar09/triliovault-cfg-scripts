variables:
  openstack-origin: &openstack-origin cloud:bionic-train
  triliovault-pkg-source: &pkg-source "deb [trusted=yes] https://apt.fury.io/triliodata-4-2/ /"

series: bionic
applications:
  trilio-data-mover:
    charm: trilio-data-mover
    channel: 4.2/stable
    options:
       triliovault-pkg-source: *pkg-source
       nfs-shares: <NFS server IP>:<NFS share path>
       nfs-options: nolock,soft,timeo=180,intr,lookupcache=none,nfsvers=3
       verbose: true
  trilio-dm-api:
    charm: trilio-dm-api
    channel: 4.2/stable
    num_units: 1
    options:
       triliovault-pkg-source: *pkg-source
       openstack-origin: *openstack-origin
    to:
      - 'lxd:1'
  trilio-horizon-plugin:
    charm: trilio-horizon-plugin
    channel: 4.2/stable
    options:
       triliovault-pkg-source: *pkg-source
  trilio-wlm-hacluster:
    charm: hacluster
  trilio-wlm:
    charm: trilio-wlm
    channel: 4.2/stable
    num_units: 3
    options:
       triliovault-pkg-source: *pkg-source
       openstack-origin: *openstack-origin
       nfs-shares: <NFS server IP>:<NFS share path>
       nfs-options: nolock,soft,timeo=180,intr,lookupcache=none,nfsvers=3
       worker-multiplier: 0.1
       vip: <virtual ip>
       verbose: true
    to:
      - 'lxd:1'
      - 'lxd:2'
      - 'lxd:3'
relations:
  # Triliovault horizon plugin relations
  # # relation with openstack-dashboard
  - - trilio-horizon-plugin:dashboard-plugin
    - openstack-dashboard:dashboard-plugin

  # Triliovault Datamover-API relations
  # # relation with keystone
  - - trilio-dm-api:identity-service
    - keystone:identity-service
  # # relation with AMQP server
  - - trilio-dm-api:amqp
    - rabbitmq-server:amqp
  # # relation with vault certificates
  - - trilio-dm-api:certificates
    - vault:certificates
  # # relation with DB server from the router
  - - trilio-dm-api:shared-db
    - mysql:shared-db

  # Triliovault Datamover relations
  # # relation with AMQP server
  - - trilio-data-mover:amqp
    - rabbitmq-server:amqp
  # # relation with nova-compute for sub-ordinating
  - - trilio-data-mover:juju-info
    - nova-compute:juju-info
  # # relation with db
  - - trilio-data-mover:shared-db
    - mysql:shared-db
  # # relation with CEPH
  - - trilio-data-mover:ceph
    - ceph-mon:client

  # Triliovault Workloadmgr relations
  # # relation with db
  - - trilio-wlm:shared-db
    - mysql:shared-db
  # # relation with AMQP server
  - - trilio-wlm:amqp
    - rabbitmq-server:amqp
  # # relation with keystone
  - - trilio-wlm:identity-service
    - keystone:identity-service
  # # relation with vault certificates
  - - trilio-wlm:certificates
    - vault:certificates
  # # relation with HA cluster
  - - trilio-wlm
    - trilio-wlm-hacluster